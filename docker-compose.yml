services:
  # Nginx - Web Server
  nginx:
    image: nginx:alpine
    container_name: laravel_nginx
    ports:
      - "80:80"
    volumes:
      - ./server:/var/www/html
      - ./server/docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - php
      - react
    networks:
      - laravel_network

  # PHP-FPM - Backend Laravel
  php:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: laravel_php
    volumes:
      - ./server:/var/www/html
    environment:
      - DB_CONNECTION=sqlite
      - DB_DATABASE=/var/www/html/database/database.sqlite
    networks:
      - laravel_network

  # React - Frontend
  react:
    build:
      context: ./client
      dockerfile: Dockerfile
    container_name: laravel_react
    ports:
      - "3000:3000"
    volumes:
      - ./client:/app
      - /app/node_modules
    environment:
      - REACT_APP_API_URL=http://localhost/api
    stdin_open: true
    tty: true
    command: npm run dev
    networks:
      - laravel_network

networks:
  laravel_network:
    driver: bridge